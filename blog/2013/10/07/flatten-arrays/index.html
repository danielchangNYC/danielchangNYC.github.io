
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Recursive Arrays - Daniel Chang</title>
  <meta name="author" content="Daniel Chang (couchpanda / c0depanda)">

  
  <meta name="description" content="Foreword
I feel a certain level of confidence declaring that every programmer has been in the situation where he/she has 10+ tabs open trying &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://danielchangNYC.github.io/blog/2013/10/07/flatten-arrays">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="Daniel Chang" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:400,700&subset=latin" rel="stylesheet" type="text/css" />
<link href='http://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>



  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <nav id="main-nav" role="navigation">
<ul class="main-navigation">
  <li><a href="/" class="nav-link">Blog</a></li>
  <li><a href="/blog/archives" class="nav-link">Archives</a></li>
  <li><a href="" class="nav-link">RSS</a></li>
</ul>

</nav>
  
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Recursive Arrays</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-07T13:00:00-04:00" pubdate data-updated="true">Oct 7<span>th</span>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://danielchangNYC.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2 id="foreword">Foreword</h2>
<p>I feel a certain level of confidence declaring that every programmer has been in the situation where he/she has 10+ tabs open trying troubleshooting a problem and finally concludes, “There must be an easier way.” Or, if you’ve been ‘in the zone’ for long enough, you might start wondering what exactly got you in this troubleshooting hell to begin with.</p>

<p>In this post, I will share what I learned from one such experience. </p>

<h3 id="context-and-problem">Context and Problem</h3>

<p>I was writing an automatic schedule-maker in Ruby. create_groups is a method that, takes an array of student names and returns an array of the students in a specified group sizes. The create_groups method also takes a parameter that allows you to specify a number of groups. The student groups should be randomized.</p>

<p>First, I defined the method create_groups, set up an array of grouped students that I can push groups into, and returned the value.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class="line">  <span class="n">groups</span> <span class="o">=</span> <span class="o">[]</span>  <span class="c1">#=&gt; store the groups of students in this array</span>
</span><span class="line">  <span class="c1"># Implement magic.</span>
</span><span class="line">  <span class="n">groups</span>  <span class="c1">#=&gt; Return groups</span>
</span><span class="line"><span class="k">end</span>
</span><span class="line"><span class="n">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span><span class="line"><span class="n">students</span> <span class="o">=</span> <span class="o">[.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.]</span> <span class="c1">#=&gt; This array contains 41 student names. Check my Github Gist linked below for the array I used in the completed program.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>After considering several strategies, I decided that it would make the most sense sort the 40 students using what I dubbed the “card dealing method” – The first student goes to group 1, the second to group 2, the third to group 3, and so forth.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class="line">  <span class="n">groups</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class="line">  <span class="n">normalized_list</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class="line">  <span class="n">normalized_list</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
</span><span class="line">    <span class="c1"># This part will sort students using the &quot;card-dealing method&quot;</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">  <span class="n">groups</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Since there are 20 groups of 4, I needed 80 students. On an abstract level, the number of students I need in order to sort (the “desired length”) is “# of groups” x “# of students per group”.</p>

<p>I decided to create another method which would normalize my list to this set amount.</p>

<p>The #normalize method will return an array of desired length by <em>replicating the students a number of times, and then slicing out the desired number of students from the replicated array.</em></p>

<p>Here’s what I came up with at first:
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class="line">  <span class="c1">#...folded this code for now...</span>
</span><span class="line"><span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">list_to_norm</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class="line">  <span class="n">desired_length</span> <span class="o">=</span> <span class="n">group_size</span><span class="o">*</span><span class="n">number_of_groups</span>
</span><span class="line">  <span class="n">new_list</span> <span class="o">=</span> <span class="n">list_to_norm</span>
</span><span class="line">  <span class="k">while</span> <span class="n">new_list</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">desired_length</span>
</span><span class="line">    <span class="n">new_list</span> <span class="o">&lt;&lt;</span> <span class="n">list_to_norm</span>
</span><span class="line">    <span class="n">new_list</span> <span class="o">=</span> <span class="n">new_list</span><span class="o">.</span><span class="n">flatten</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;</p>

<p>When I ran this given a student array though, I received the following error:
&lt;div class=&#8217;bogus-wrapper&#8217;&gt;<notextile><figure class="code">&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;&lt;div class=&#8221;highlight&#8221;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#8221;gutter&#8221;&gt;&lt;pre class=&#8221;line-numbers&#8221;&gt;<span class="line-number">1</span>
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#8217;code&#8217;&gt;&lt;pre&gt;<code class="sh"><span class="line">rb24:<span class="sb">`</span>flatten<span class="err">&#39;</span>: tried to flatten recursive array <span class="o">(</span>ArgumentError<span class="o">)</span>
</span></code>&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</figure></notextile>&lt;/div&gt;</p>

<p>WAT? After many attempts at troubleshooting and searching the web for an answer, I decided to inspect what exactly I was trying to flatten.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">list_to_norm</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class="line">  <span class="n">desired_length</span> <span class="o">=</span> <span class="n">group_size</span><span class="o">*</span><span class="n">number_of_groups</span>
</span><span class="line">  <span class="n">new_list</span> <span class="o">=</span> <span class="n">list_to_norm</span>
</span><span class="line">  <span class="n">new_list</span> <span class="o">&lt;&lt;</span> <span class="n">list_to_norm</span>
</span><span class="line">  <span class="nb">puts</span> <span class="n">new_list</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The output was VERY telling. The <code>...</code> line below is just a placeholder for names 4 through 40.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">Name1
</span><span class="line">Name2
</span><span class="line">Name3
</span><span class="line">...
</span><span class="line">Name41
</span><span class="line"><span class="o">[</span>...<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The clue was in the <code>[...]</code>.</p>

<p>I then tried running <code>new_list.object_id</code> and <code>list_to_norm.object_id</code> and they turned out to be the same.</p>

<h3 id="a-ha">A-ha!</h3>

<p>The <code>[...]</code> indicated that new_list is now a <em>recursive array</em>. More on recurive arrays <a href="http://stackoverflow.com/questions/10606734/what-are-recursive-arrays-good-for">here</a>.</p>

<p>As it turns out, my problem was in the 2nd line of my normalize method.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">new_list</span> <span class="o">=</span> <span class="n">list_to_norm</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>This line of code sets the <code>new_list</code> variable to point at the exact same object as the <code>list_to_norm</code> method. So later, when I called <code>new_list &lt;&lt; list_to_norm</code>, I ended up pushing an Array object into itself. The image below </p>

<p>However, Ruby clearly didn’t like this, and I suspect that it has to do with the way <code>Array.flatten</code> works. At the very least, we can conclude that <code>.flatten</code> can only flatten two different Array objects.</p>

<p>So that’s what I learned in 40 minutes of head-banging against a figurative brick wall. I hope you learned something as well from this post!</p>

<p>Also, as promised, here is a link to <a href="https://gist.github.com/danielchangNYC/6787872">my full gist</a>.</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Daniel Chang (couchpanda / c0depanda)</span></span>

      








  


<time datetime="2013-10-07T13:00:00-04:00" pubdate data-updated="true">Oct 7<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/aha/'>aha</a>, <a class='category' href='/blog/categories/arrays/'>arrays</a>, <a class='category' href='/blog/categories/object-oriented-programming/'>object_oriented_programming</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://danielchangNYC.github.io/blog/2013/10/07/flatten-arrays/" data-via="danielchangNYC" data-counturl="http://danielchangNYC.github.io/blog/2013/10/07/flatten-arrays/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/10/04/week-2/" title="Previous Post: (Not the) First Post">&laquo; (Not the) First Post</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/10/08/rails-presentation-post/" title="Next Post: ActiveRecord">ActiveRecord &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Daniel Chang (couchpanda / c0depanda) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'danielchangnyc';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://danielchangNYC.github.io/blog/2013/10/07/flatten-arrays/';
        var disqus_url = 'http://danielchangNYC.github.io/blog/2013/10/07/flatten-arrays/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
