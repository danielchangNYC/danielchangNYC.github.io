
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>All Posts - Daniel Chang</title>
	<meta name="author" content="Daniel Chang">

	
	<meta name="description" content="All Posts Checking for Set Completeness in Rails Using Array Intersection While working on the Flatiron School pre-work progress-tracker, I kept &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="" rel="alternate" title="Daniel Chang" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Daniel Chang</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:danielchangNYC.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/117389635991723583799?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/danielchangNYC" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/danielchangNYC" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:danielchangNYC.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><div class="all-posts">
  <div class="container">
    <div class="row">
      <div class="list-title col-md-offset-3 col-md-6">
        <h4>All Posts</h4>
      </div>
    </div>
  </div>

  <div class="article-list">
    <div class="container">
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/04/24/set-intersection/">Checking for Set Completeness in Rails Using Array Intersection</a></h2>
  
  <p>
    <p>While working on the <a href="http://prework.flatironschool.com/">Flatiron School pre-work</a> progress-tracker, I kept finding myself feeling uncomfortable with the <code>topic_complete?</code> and <code>add_lesson</code> methods below.</p>




<h1>Smelly Methods</h1>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Progress</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:topic</span>
</span><span class='line'>  <span class="n">serialize</span> <span class="ss">:completed_lessons</span><span class="p">,</span> <span class="nb">Array</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">topic_complete?</span>
</span><span class='line'>    <span class="n">topic</span><span class="o">.</span><span class="n">total_lessons</span> <span class="o">==</span> <span class="n">completed_lessons</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Topic</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:progresses</span>
</span><span class='line'>  <span class="n">serialize</span> <span class="ss">:lesson_order</span><span class="p">,</span> <span class="nb">Array</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_lesson</span><span class="p">(</span><span class="n">lesson</span><span class="p">)</span>
</span><span class='line'>    <span class="n">lesson_order</span> <span class="o">&lt;&lt;</span> <span class="n">lesson</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'>    <span class="n">total_lessons</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<h1>The Source of Stink</h1>




<p><code>add_lesson</code> felt brittle. A new coder on this project has to know to add lessons using this method; the design is therefore NOT transparent. There is also a duplication of data: the <code>total_lessons</code> attribute and the length of the <code>lesson_order</code> array should always be the same, so why do we need <code>total_lessons</code>? The code therefore violates the DRY principle.</p>




<p><code>topic_complete?</code> has another host of what-if situations. Consider the possibilities:</p>




<ul>
<li>An admin removes lessons from the topic. <code>topic_complete? # =&gt; false</code>.</li>
<li>An admin replaces a lesson in the topic. <code>topic_complete? # =&gt; true</code>.</li>
<li><code>total_lessons</code> doesn&rsquo;t get updated using <code>add_lesson</code>. See above.</li>
</ul>




<p>I needed a way to actually compare what was in the two arrays, <code>completed_lessons</code> and <code>lesson_order</code>.</p>




<h1>An Unlikely But Elegant Solution</h1>




<p>I considered iterating through <code>lesson_order</code> and comparing with <code>completed_lessons</code>, but this seemed cumbersome; &ldquo;There must be an easier way,&rdquo; thought Daniel.</p>




<p>Then it hit me: this is a <strong>set intersection</strong> problem. (Duh, it&rsquo;s in the title!)</p>




<p>Set theory review: The intersection of two sets is the set of all common elements. Luckily, Ruby class Array has such a method which can be used like an operator: <code>&amp;</code>.</p>




<h1>Solution 1 => #fail</h1>




<p>The <a href="http://www.ruby-doc.org/core-2.1.1/Array.html#method-i-26">&amp; operator</a> is called the set intersection operator.</p>


<p><figure class='code'><figcaption><span>example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">]</span> <span class="o">&amp;</span> <span class="o">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">]</span>    <span class="c1">#=&gt; [ 1, 3 ]</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>I tried:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">topic_complete?</span>
</span><span class='line'>  <span class="n">completed_lessons</span> <span class="o">&amp;</span> <span class="n">topic</span><span class="o">.</span><span class="n">lesson_order</span> <span class="o">==</span> <span class="n">topic</span><span class="o">.</span><span class="n">lesson_order</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>&hellip;which failed.</p>




<h1>Why Solution 1 Failed</h1>


<p><figure class='code'><figcaption><span>irb-fiddling</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">lesson_order</span> <span class="o">=</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span>
</span><span class='line'><span class="n">completed_lessons</span> <span class="o">=</span> <span class="o">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">lesson_order</span> <span class="o">&amp;</span> <span class="n">completed_lessons</span>
</span><span class='line'>   <span class="c1"># =&gt; [3, 2, 5]</span>
</span><span class='line'>
</span><span class='line'><span class="n">completed_lessons</span> <span class="o">&amp;</span> <span class="n">lesson_order</span>
</span><span class='line'>   <span class="c1"># =&gt; [5, 2, 3]</span>
</span><span class='line'>
</span><span class='line'><span class="n">completed_lessons</span> <span class="o">&amp;</span> <span class="n">lesson_order</span> <span class="o">==</span> <span class="n">lesson_order</span>
</span><span class='line'>   <span class="c1"># =&gt; false</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Note: <code>&amp;</code> ignores doubles.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span>
</span><span class='line'>  <span class="c1"># =&gt; [2]</span>
</span><span class='line'>
</span><span class='line'><span class="n">b</span> <span class="o">&amp;</span> <span class="n">a</span>
</span><span class='line'>  <span class="c1"># =&gt; [2]</span>
</span></code></pre></td></tr></table></div></figure></p>

<h1>Solution 2: o(^_^)b</h1>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">topic_complete?</span>
</span><span class='line'>  <span class="n">topic</span><span class="o">.</span><span class="n">lesson_order</span> <span class="o">&amp;</span> <span class="n">completed_lessons</span> <span class="o">==</span> <span class="n">topic</span><span class="o">.</span><span class="n">lesson_order</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>&ldquo;Huzzah!&rdquo; thought Daniel.</p>




<h1>BONUS: How Does <code>#&amp;</code> Work?</h1>




<p>I took a a deep dive into Ruby source code to figure this one out.</p>




<p>Here&rsquo;s the code in C.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="k">static</span> <span class="n">VALUE</span>
</span><span class='line'><span class="nf">rb_ary_and</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">ary1</span><span class="p">,</span> <span class="n">VALUE</span> <span class="n">ary2</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">VALUE</span> <span class="n">hash</span><span class="p">,</span> <span class="n">ary3</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>    <span class="n">st_table</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
</span><span class='line'>    <span class="n">st_data_t</span> <span class="n">vv</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ary2</span> <span class="o">=</span> <span class="n">to_ary</span><span class="p">(</span><span class="n">ary2</span><span class="p">);</span>
</span><span class='line'>    <span class="n">ary3</span> <span class="o">=</span> <span class="n">rb_ary_new</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">ary3</span><span class="p">;</span>
</span><span class='line'>    <span class="n">hash</span> <span class="o">=</span> <span class="n">ary_make_hash</span><span class="p">(</span><span class="n">ary2</span><span class="p">);</span>
</span><span class='line'>    <span class="n">table</span> <span class="o">=</span> <span class="n">rb_hash_tbl_raw</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary1</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">v</span> <span class="o">=</span> <span class="n">RARRAY_AREF</span><span class="p">(</span><span class="n">ary1</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="n">vv</span> <span class="o">=</span> <span class="p">(</span><span class="n">st_data_t</span><span class="p">)</span><span class="n">v</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">st_delete</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vv</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">rb_ary_push</span><span class="p">(</span><span class="n">ary3</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">ary_recycle_hash</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">ary3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Full disclosure: I&rsquo;ve never read or written C in my life, but with the help of the <a href="http://rxr.whitequark.org/mri/ident">MRI Identifier Search</a>, I was able to piece together what this does.</p>




<p>The key to understanding this is in the <code>for</code> loop.</p>




<ul>
<li>ary1 and ary2 represent the arrays for which we&rsquo;re finding the intersection. ary3 is what the function <code>rb_ary_and</code> returns.</li>
<li>v represents ary1i]`, in Ruby-speak.</li>
<li>vv is somehow tied to that value.</li>
<li><code>st_delete</code> returns 1 if <code>vv</code> was successfully deleted from <code>table</code>, which really refers to ary2, and 0 if it wasn&rsquo;t found. If it gets deleted, then that means ary2 must have had an element in common; push that element into ary3.</li>
</ul>




<h1>So how efficient is this method?</h1>




<p>In the worst-case scenario, ary1 and ary2 are giant arrays with completely disparate elements, requiring the algorithm to compare all elements of ary2 with all elements of ary1. Given there are <em>x</em> elements in ary1 and <em>y</em> elements in ary2, this would produce a O(x*y).</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2014-04-24T09:51:00-04:00" pubdate data-updated="true">Apr 24<span>th</span>, 2014</time> in 
    


	<a class='category' href='/blog/categories/array-operators/'>array-operators</a>, <a class='category' href='/blog/categories/big-o/'>big-o</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/set-intersection-operator/'>set-intersection-operator</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/04/08/tdd3-TestingHooks/">Testing Rails Callbacks: A Step in the Right Direction</a></h2>
  
  <p>
    <p>Anyone who&rsquo;s worked with tightly-coupled models in rails will likely know the pain of tracing the stack for an error triggered from a callback method. Such painful experiences have led developers to come to a consensus on general rules like <a href="http://blog.bignerdranch.com/1658-the-only-acceptable-use-for-callbacks-in-rails-ever/">&ldquo;Use a callback only when the logic refers to state internal to the object&rdquo;</a>, according to Jonathan Wallace. More on this topic by Samuel Mullen in a great blogpost, <a href="http://www.samuelmullen.com/2013/05/the-problem-with-rails-callbacks/">The Problem with Rails Callbacks</a>.</p>




<p>The following post revolves around an <code>Invitation</code> model I wrote with my team mates and then later debated the callback to use.</p>




<p>The <code>Invitation</code> model generates a unique token which it uses to identify users who have clicked on a registration link.</p>




<p>The callback I chose to use first was <code>after_initialize</code> because an <code>invite</code> object must always have a <code>token</code>.</p>


<p><figure class='code'><figcaption><span>invitation.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Invitation</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">after</span> <span class="kp">initialize</span> <span class="ss">:add_token</span> <span class="c1">#NOTE my syntax highlighter dislikes the underscore. see below.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_unique_token</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="no">Tokenizer</span><span class="o">.</span><span class="n">Generate</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><strong>NOTE</strong> <code>after initialize</code> above should be <code>after_initialize</code>. For some reason my syntax highlighting plugin doesn&rsquo;t like the underscore in the correct version.</p>




<p>The associated test:</p>


<p><figure class='code'><figcaption><span>invitation_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Invitation</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;generates a random token on initialize&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">invite</span> <span class="o">=</span> <span class="no">Invitation</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">invite</span><span class="o">.</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>However, another team mate suggested using <code>before_create</code> instead.</p>




<p>His model and test:</p>


<p><figure class='code'><figcaption><span>invitation.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Invitation</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">before_create</span> <span class="ss">:add_token</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_unique_token</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="no">Tokenizer</span><span class="o">.</span><span class="n">generate</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>invitation_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Invitation</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;generates a random token before create&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">invite</span> <span class="o">=</span> <span class="no">Invitation</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">invite</span><span class="o">.</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_nil</span>
</span><span class='line'>    <span class="n">invite</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">invite</span><span class="o">.</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3>Why does this subtle change matter?</h3>




<p>First, <strong>using <code>after_initialize</code> could produce a false positive.</strong> While the <code>after_initialize</code> test does exactly what the <code>it</code> statement says, there&rsquo;s a chance that we may miss, say, a validation error that happens before <code>save</code>. This test would pass, and so would the validations, but for some reason you might find that your invitations aren&rsquo;t working properly. <code>after_initialize</code> allows us to omit saving from the test, which one could generally assume is always desired given that callbacks should only &ldquo;refer to state internal to an object&rdquo;.</p>




<p>Additionally, <strong>if you&rsquo;re testing a callback that affects the internal state of an object, we must test for a state-change.</strong> Using <code>after_initialize</code>, we can tell that a new invite has a token. However, we cannot say that we&rsquo;ve tested the non-presence and the presence of the token. The pivotal point again is around <code>#save</code>. <code>#save</code> triggers the change and we can say with certainty that we&rsquo;ve not only seen a &ldquo;zero to one&rdquo; change happen, but that the change has persisted in our database.</p>




<p>UPDATE: <a href="https://twitter.com/scottadhoc/status/453917228648640512">Twitter comment</a> from <a href="https://twitter.com/scottadhoc">@scottadhoc</a>: &ldquo;what happens if you load that record from the db into a new object and then assert on that field?&rdquo;</p>




<p>Good point! If I understand your suggestion correctly, here&rsquo;s how I might refactor the after_initialize version of the spec:</p>


<p><figure class='code'><figcaption><span>invitation_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Invitation</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;generates a random token #after_initialize&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">invite</span> <span class="o">=</span> <span class="no">Invitation</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">invite</span><span class="o">.</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_nil</span>
</span><span class='line'>    <span class="n">invite</span><span class="o">.</span><span class="n">save!</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">invite</span><span class="o">.</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This way, we can make sure that the data persisted. While this works, my feeling is that the implication of testing after_initialize allows one to omit the persistence part. I certainly fell into that trap and wouldn&rsquo;t be surprised if I forget again while testing an after_initialize callback.</p>




<p>Lastly, if you use <code>after_initialize</code> with the underscore in a block of code in <code>Octopress</code>, your blog will refuse to generate. Coincidence? I think not.</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2014-04-08T09:00:00-04:00" pubdate data-updated="true">Apr 8<span>th</span>, 2014</time> in 
    


	<a class='category' href='/blog/categories/callbacks/'>callbacks</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/rspec/'>rspec</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/01/15/tdd2-RSpecMatchers/">RSpec Custom Matchers: A Deep Dive</a></h2>
  
  <p>
    <h1>What&rsquo;s a Matcher?</h1>




<p><code>expect(dan.current_zipcode).to eq(10002)</code></p>




<p>In the line above, the <code>matcher</code> is the method <code>eq</code> because RSpec will check to see if the value of <code>dan.current_zipcode</code> matches <code>10002</code>.</p>




<p>Let&rsquo;s say that this was a line you wrote for as part of a test for a location tracking app. You want your code to be as clear as possible for collaborators or even for your future self.</p>




<p>Wouldn&rsquo;t it sound even better if you could write this?</p>




<p><code>expect(dan).to be_in_zipcode(10002)</code></p>




<p>This requires <code>be_in_zipcode</code> to be a method in <code>RSpec</code>&rsquo;s matcher library. I&rsquo;m going to briefly explain how to create this new matcher, but for alternate explanations, check out the <a href="https://github.com/dchelimsky/rspec/wiki/Custom-Matchers">Rspec Github Wiki</a> and Chapter 7 of Aaron Sumner&rsquo;s <a href="https://leanpub.com/everydayrailsrspec">Everyday Rails Testing with RSpec</a>.</p>




<p>My intention is not to write another Matcher tutorial (though this might inevitably happen). After reading Sumner&rsquo;s chapter, I could imagine how matchers were created but ultimately, I felt a bit uncertain. With a little bit of <code>Pry</code> magic and doc-digging, I think I&rsquo;ve finally put most of the puzzle together which I&rsquo;m looking forward to sharing below! Constructive feedback and deeper insights are always welcome. :)</p>




<h1>Match-Maker, Match-Maker, Make Me a Match!</h1>




<p>Let&rsquo;s write some code so that we can use the method <code>be_in_zipcode(10002)</code> from above.</p>




<p>General syntax at bare minimum first:</p>


<p><figure class='code'><figcaption><span>syntax.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">RSpec</span><span class="p">:</span><span class="ss">:Matchers</span><span class="o">.</span><span class="n">define</span> <span class="ss">:new_matcher_name</span> <span class="k">do</span> <span class="o">|</span><span class="n">expected</span><span class="o">|</span>
</span><span class='line'>  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
</span><span class='line'>    <span class="c1"># Lines of code you want this matcher to run</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#optional description and failure message definition blocks</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From the describe block:</span>
</span><span class='line'><span class="c1"># expect(actual).to matcher_method(expected)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>NOTE: Store your matcher files in <code>spec/support/matchers/</code> and require them in <code>spec/spec_helper.rb</code> with the following line:</p>




<p><code>Dir[File.dirname(__FILE__) + "/support/**/*.rb"].each {|f| require f}</code></p>




<p>Now onto our example:</p>


<p><figure class='code'><figcaption><span>be_in_zipcode.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">RSpec</span><span class="p">:</span><span class="ss">:Matchers</span><span class="o">.</span><span class="n">define</span> <span class="ss">:be_in_zipcode</span> <span class="k">do</span> <span class="o">|</span><span class="n">zipcode</span><span class="o">|</span>
</span><span class='line'>  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">friend</span><span class="o">|</span>
</span><span class='line'>    <span class="n">friend</span><span class="o">.</span><span class="n">in_zipcode?</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Optional failure messages</span>
</span><span class='line'>  <span class="n">failure_message_for_should</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;expected friend to be in zipcode&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">failure_message_for_should_not</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;expected friend not to be in zipcode&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Optional method description</span>
</span><span class='line'>  <span class="n">description</span> <span class="k">do</span>
</span><span class='line'>    <span class="s2">&quot;checks user&#39;s current zipcode&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Again, the failure messages and description are optional blocks. The match block is obviously mandatory. So now that we have our new matcher, let&rsquo;s check out what&rsquo;s going on behind the scenes.</p>




<h1>Under the hood</h1>




<p><code>RSpec::Matchers.define :be_in_zipcode do |zipcode|</code></p>




<p>The <code>define</code> method, extended from the DSL module, does the following:</p>


<p><figure class='code'><figcaption><span>define.rb RSpec::Matchers::DSL#define</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">define</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">declarations</span><span class="p">)</span>
</span><span class='line'>  <span class="n">matcher_template</span> <span class="o">=</span> <span class="ss">RSpec</span><span class="p">:</span><span class="ss">:Matchers</span><span class="o">::</span><span class="ss">DSL</span><span class="p">:</span><span class="ss">:Matcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">declarations</span><span class="p">)</span>
</span><span class='line'>  <span class="n">define_method</span> <span class="nb">name</span> <span class="k">do</span> <span class="o">|<em></span><span class="n">expected</span><span class="o">|</span>    <span class="c1"># =&gt; expected for us is the var zipcode</span>
</span><span class='line'>    <span class="n">matcher</span> <span class="o">=</span> <span class="n">matcher_template</span><span class="o">.</span><span class="n">for_expected</span><span class="p">(</span><span class="o"></em></span><span class="n">expected</span><span class="p">)</span>
</span><span class='line'>    <span class="n">matcher</span><span class="o">.</span><span class="n">matcher_execution_context</span> <span class="o">=</span> <span class="vi">@matcher_execution_context</span> <span class="o">||=</span> <span class="nb">self</span>
</span><span class='line'>    <span class="n">matcher</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># name = be_in_zipcode</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The second line setting <code>matcher_template</code> initializes an <code>RSpec::Matchers::DSL::Matcher</code> object which stores the method name and the declarations block.</p>




<p><code>define_method</code> then creates the <code>be_in_zipcode</code> method. The next line&rsquo;s <code>for_expected(*expected)</code> method sets the zipcode as the expected value and your failure messages/description from the matcher template in the second line. The messages and description are stored in the @messages attribute hash.</p>




<p>The next line I&rsquo;m not sure about since <code>matcher_execution_context</code> refers to an attribute accessor. I don&rsquo;t see it in the Matcher module either. Any insight here would be great!</p>




<p>Moving onto the last piece: the match block.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">friend</span><span class="o">|</span>
</span><span class='line'>    <span class="n">friend</span><span class="o">.</span><span class="n">in_zipcode?</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><code>RSpec::Match#match</code> stores the given block in <code>@match_block</code>, so essentially, <code>@match_block = friend.in_zipcode?(zipcode)</code>.</p>




<p>Later, when you run your specs with the new matcher, the <code>match_block</code> will get called from the method <code>RSpec::Match#matches?</code>.</p>


<p><figure class='code'><figcaption><span>matches?</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">matches?</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@actual</span> <span class="o">=</span> <span class="n">actual</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@expected_exception</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="n">instance_exec</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="o">&amp;</span><span class="vi">@match_block</span><span class="p">)</span>
</span><span class='line'>      <span class="kp">true</span>
</span><span class='line'>    <span class="k">rescue</span> <span class="vi">@expected_exception</span>
</span><span class='line'>      <span class="kp">false</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="n">instance_exec</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="o">&amp;</span><span class="vi">@match_block</span><span class="p">)</span>
</span><span class='line'>    <span class="k">rescue</span> <span class="ss">Spec</span><span class="p">:</span><span class="ss">:Expectations</span><span class="o">::</span><span class="no">ExpectationNotMetError</span>
</span><span class='line'>      <span class="kp">false</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>And that&rsquo;s it!</p>




<p>So if I were to run the original line, <code>expect(dan).to be_in_zipcode(10002)</code>, the following would happen:</p>




<ol>
<li><code>expect(dan)</code> returns an <code>RSpec::Expectations::ExpectationTarget</code> object storing the object <code>dan</code>. Specifically: <code>=&gt; #&lt;RSpec::Expectations::ExpectationTarget:0x007fbf511e4c78 @target=#&lt;User id: 1, name: dan&gt;&gt;</code></li>
<li>the <code>to</code> method passes in <code>be_in_zipcode(10002)</code> and calls a method called <code>handle_matcher</code>&hellip;</li>
<li>&hellip; which checks if <code>be_in_zipcode</code> has been defined as a matcher.</li>
<li>Since we&rsquo;ve defined <code>be_in_zipcode</code>, <code>matches?</code> gets called our block, which we saw above.</li>
<li><code>handle_matcher</code> then figures out how to respond, given the messages you passed in when you defined the new matcher.</li>
</ol>




<p>That&rsquo;s our deep dive into RSpec&rsquo;s Custom Matchers. Again, feedback always welcome. Hope you enjoyed the complexity as much as I did! :)</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2014-01-15T06:40:00-05:00" pubdate data-updated="true">Jan 15<span>th</span>, 2014</time> in 
    


	<a class='category' href='/blog/categories/matcher/'>matcher</a>, <a class='category' href='/blog/categories/matchers/'>matchers</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/rspec/'>rspec</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/01/13/tdd1-ActiveRecordEqualityRogue/">ActiveRecord, Equality, and Rogue</a></h2>
  
  <p>
    <p><img class="right" src="http://static.comicvine.com/uploads/original/8/85629/1887574-rogue1.gif" title="Rogue" >
Almost done with my model specs! I ran into a couple of interesting problems that I posted on Stack Overflow, one of which I&rsquo;ll cover briefly below. Oh yeah, and Rogue! I&rsquo;ll explain that in the last section of this post.</p>




<h2>The problem I ran into (from my <a href="https://stackoverflow.com/questions/21102549/why-is-the-where-query-in-rails-returning-a-different-object">StackOverflow post</a>)</h2>




<p><em>If you just read the whole post, skip to the last section of this blog post.</em></p>




<p>I&rsquo;m testing chats between users in my app. I&rsquo;m using RSpec and FactoryGirl</p>




<p>The test that&rsquo;s not passing:</p>


<p><figure class='code'><figcaption><span>chat_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;creates a chat if one does not exist&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">bob</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">dan</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s2">&quot;dan&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">new_chat</span> <span class="o">=</span> <span class="no">Chat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">dan</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">chatted_user_id</span><span class="p">:</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="no">Chat</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;chatted_user_id = ?&quot;</span><span class="p">,</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">equal</span><span class="p">(</span><span class="n">new_chat</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The failure message says:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Failure/Error: expect<span class="o">(</span>Chat.where<span class="o">(</span><span class="s2">&quot;chatted_user_id = ?&quot;</span>, bob.id<span class="o">)</span>.first<span class="o">)</span>.to equal<span class="o">(</span>new_chat<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>   expected <span class="c">#&lt;Chat:70120833243920&gt; =&gt; #&lt;Chat id: 2, user_id: 2, chatted_user_id: 3&gt;</span>
</span><span class='line'>        got <span class="c">#&lt;Chat:70120833276240&gt; =&gt; #&lt;Chat id: 2, user_id: 2, chatted_user_id: 3&gt;</span>
</span><span class='line'>
</span><span class='line'>   Compared using equal?, which compares object identity,
</span><span class='line'>   but expected and actual are not the same object. Use
</span><span class='line'>   <span class="sb"><code>&lt;/span&gt;expect&lt;span class="o"&gt;(&lt;/span&gt;actual&lt;span class="o"&gt;)&lt;/span&gt;.to eq&lt;span class="o"&gt;(&lt;/span&gt;expected&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="sb"&gt;</code></span> <span class="k">if </span>you don<span class="err">&#39;</span>t care about
</span><span class='line'>   object identity in this example.
</span></code></pre></td></tr></table></div></figure></p>

<p>Why is my query returning a different object id?</p>




<h3>Answer from Simone Carletti on StackOverflow</h3>




<p>equal checks object identity. The objects you are testing are two objects (instances) referencing the same record, but they are actually different objects from a Ruby virtual machine point of view.</p>




<p>You should use</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">expect</span><span class="p">(</span><span class="no">Chat</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;chatted_user_id = ?&quot;</span><span class="p">,</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">new_chat</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>To better understand the problem, look at the following example</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">&ndash;</span><span class="n">p353</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="s2">&quot;foo&quot;</span><span class="o">.</span><span class="n">object_id</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="mi">70117320944040</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">&ndash;</span><span class="n">p353</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="s2">&quot;foo&quot;</span><span class="o">.</span><span class="n">object_id</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="mi">70117320962820</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Here I&rsquo;m creating two identical strings. They are identical, but not equal because they are actually two different objects.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">&ndash;</span><span class="n">p353</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="s2">&quot;foo&quot;</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">&ndash;</span><span class="n">p353</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="s2">&quot;foo&quot;</span><span class="o">.</span><span class="n">equal?</span> <span class="s2">&quot;foo&quot;</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That&rsquo;s the same issue affecting your test. equal checks if two objects are actually the same at the object_id level. But what you really want to know is if they are the same record.</p>




<h2>So what&rsquo;s happening under the hood?</h2>




<p>The &ldquo;where&rdquo; query returns an array of objects matching the query, and those objects must be Active Record objects that just handle the data. If I make another query, Active Record must be creating another set of objects to handle each row of data.</p>




<p>I wanted to confirm this before throwing it out on the web as &ldquo;fact&rdquo;, so here&rsquo;s what an Active Record object is from <a href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">Martin Fowler himself</a>:</p>




<blockquote><p>An object that wraps a row in a database table or view, encapsulates the database access, and adds domain logic on that data.</p></blockquote>




<p>Think of an Active Record object sort of like Rogue (see above). For those of you who don&rsquo;t remember, Rogue absorbs the memories and abilities of any person she touches.</p>




<p><img src="http://31.media.tumblr.com/25cd14bae1b207202d0ee9b56b475409/tumblr_mzd6fjLYmf1sqhdy2o1_1280.png" width="480" title="Comic Picture Rogue's Powers" ></p>




<p>Similarly (sorta), an Active Record objects takes the data (memories) of a certain row and then takes on the behavior (abilities) of the object type matching the table name.</p>




<p>Ok, so that was really just an excuse to get Rogue somewhere on my blog. While I&rsquo;m at it, here&rsquo;s one of her destroying Ororo (Storm).</p>




<p><img src="http://i22.photobucket.com/albums/b310/RogueX18/Rogue%20Absorptions/UncannyX-Men158Storm.jpg" title="Rogue and Storm Picture" ></p>




<p>So there you have it! Moral of the story: generally remember to use eq to test equivalence in RSpec with ActiveRecord.</p>




<p>Oh, and here&rsquo;s a <a href="https://www.relishapp.com/rspec/rspec-expectations/v/2-0/docs/matchers/equality-matchers">bonus resource: equal, eql, eq, and ==</a> in RSpec.</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2014-01-13T23:00:00-05:00" pubdate data-updated="true">Jan 13<span>th</span>, 2014</time> in 
    


	<a class='category' href='/blog/categories/activerecord/'>activerecord</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/rspec/'>rspec</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/01/12/tdd0-whyttd/">How and Why I Began Testing in Ruby on Rails</a></h2>
  
  <p>
    <p>Testing is one of those things that feels a bit like eating well or going to the gym. Since it&rsquo;s already ten days into the New Year and I have yet to commit to any resolutions, let this be it: no more will I make excuses for skipping testing.</p>




<p>What does this really mean to me though? Am I eating broccoli just because someone told me it&rsquo;s good for me? Here are three reasons that have driven me to make the change.</p>




<h2>TDD Reason 1: Manual Testing Sucks; TDD Saves Time</h2>




<p>My friend told me about the job she left before coming to the Flatiron School and one of her responsibilities looked a bit like this:</p>




<p><img src="http://blog.polarion.com/wp-content/uploads/2012/12/Screen-Shot-2012-12-06-at-12.07.14-PM.png"></p>




<p>What. A. Nightmare. There should be a -phobia for this.</p>




<p>Don&rsquo;t get me wrong &mdash; I&rsquo;m sure this could be pretty efficient if the scope of the UX is very small, or you don&rsquo;t know-how to implement TDD yet. However, how can you be sure your site won&rsquo;t expand, or why not learn how to use a gem like Capybara to save you time in the future? Used in conjuction with Guard, you could really save some serious time while coding!</p>




<h2>TDD Reason 2: Code Confidence</h2>




<p>Now that I&rsquo;ve had a bit more experience writing web apps (still without TDD), I&rsquo;ve had the pleasure of seeing them grow and change throughout development. On the other hand, everytime I implemented a new feature, I had less and less confidence that the rest of my code base would work fine. At some point, the prospect of a new feature started feeling like a laundry list or the guarantee of a new bug. Testing will certainly help me find bugs as I introduce them, and therefore boost my confidence in in my code.</p>




<h2>TDD Reason 3: Thinking Before Doing</h2>




<p>Writing tests before writing production code forces you to clearly iterate what it is you want your application to do before you start coding. Ideally, you want your tests to last as long as possible as well, so it will force you to make important decisions about design as well. The prospect of having well thought-out code with lasting design excites me! I&rsquo;ve had several experiences already of trying to refactor poorly designed code and it&rsquo;s quite painful.</p>




<h2>My Next Steps</h2>




<p>I&rsquo;ve decided to begin my TDD exploration by refactoring my first app, Little Red Wagon (LRW). My current reads are Aaron Sumner&rsquo;s book, <a href="https://leanpub.com/everydayrailsrspec">Everyday Rails Testing with RSpec</a>, and <a href="http://www.amazon.com/Practical-Object-Oriented-Design-Ruby-Addison-Wesley/dp/0321721330">Practical Object-Oriented Design in Ruby</a> by Sandi Metz. I&rsquo;m about 30% through each book right now and have written a few model specs already for LRW. I&rsquo;ve decided not to use Factory Girl since it will slow down testing and Rails&#8217; built-in fixtures are satisfactory for what I currently have. In any case, the grand plan is to get some hands-on practice writing tests using the TDD book first and then taking on the much larger challenge of redesigning my code base. Thanks for reading, and more updates to come on TDD!</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2014-01-12T23:00:00-05:00" pubdate data-updated="true">Jan 12<span>th</span>, 2014</time> in 
    


	<a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/rspec/'>rspec</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/01/05/big-o/">Big O Notation</a></h2>
  
  <p>
    <p>Big O notation might look something like this: O(log N)</p>


<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>N = number of input data
</span><span class='line'>O( ) = function notation for Big O (just tells you we&rsquo;re using Big O notation)
</span><span class='line'>log N = the function that describes the efficiency of the procedure or algorithm as N grows bigger and bigger</span></code></pre></td></tr></table></div></figure></p>

<p>Programmers use Big O Notation as a way to express how efficient an algorithm or procedure is at performing its designated task (e.g. sorting, searching). The function tells us the maximum number of &ldquo;actions&rdquo; it will take for the algorithm to achieve its goal, given N data.</p>




<h2>Example 1: O(N)</h2>




<p>O(N) is the linear case. Given 10 data, the worst-case scenario is that it will take 10 &ldquo;actions&rdquo; to search for a target, or sort the data, or whatever the goal of the algorithm is. Given 100 data, it will take 100 actions. Given 2000 data, it will take 2000 actions. Given N data, it will take N actions.</p>




<p>A real life example would be if you were looking for a book on your friend&rsquo;s bookshelf.</p>




<p><img src="http://2.bp.blogspot.com/_5PudbMqUjng/TR5Cu-fq4ZI/AAAAAAAAACk/t_oojdxP-c8/s400/harrypotter.jpg" width="400"></p>




<p>Lets say you want your program to find any given book. You could tell the program to start checking books one by one from the left. If you wanted Harry Potter 3, it would only take 3 actions (or tries) because it&rsquo;s the third book in. However, Big O tells us the worst-case scenario. What book would cause the algorithm to take the most possible actions? Harry Potter 7 &mdash; it&rsquo;s the last book so the algorithm would have to run all 7 times. Given 7 books, it took the algorithm 7 actions / tries to find the book <em>in the worst case scenario</em>.</p>




<p>What if we ran this algorithm on 10 books? The worst case would take all 10 tries. How about 1,000,000 books? It would take 1 million tries.</p>




<p>So, TL;DR &mdash; O(N) tells us that given N data, it will take an algorithm N actions / tries to accomplish a task.</p>




<h2>Example 2: O(1)</h2>




<p>What does O(1) tell us? The function inside is simply &ldquo;1&rdquo;. This means that no matter what number N is, it will always accomplish the task in 1 try. It represents the most efficient algorithm possible.</p>




<p>Does this exist? Sure it does! But it might not give you exactly what you&rsquo;re looking for. Here&rsquo;s an algorithm that can be described with O(1).</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">efficient_but_useless</span>
</span><span class='line'>  <span class="k">return</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>TL;DR algorithms with O(1) always finish in 1 try.</p>




<h2>Example 3: O(N<sup>2</sup>) or any higher exponent</h2>




<p>Is this an efficient algorithm? In other words, if I input a large amount of data for N, what does that tell me about the algorithm? If I input N=1, then no matter what, it will take 1 try. But if I put in N=10, then it will take 10<sup>2</sup> = 100 actions / tries to complete the algorithm (worst case scenario). Imagine if the exponent were higher, or if N were higher. Then the algorithm would be super inefficient!</p>




<p>What kinds of algorithms would have O(N<sup>2</sup>)? Simply put, algorithms with nested loops usually exhibit this behavior. If you have to run a procedure on each item, and each item has to check itself against every other item in some way, then worst case is that you run the procedure N<sup>2</sup> times. In other words, it takes N<sup>2</sup> actions.</p>




<h2>Example 4: O(log N)</h2>




<p>This time the function is logarithmic.</p>




<p><img src="http://image.tutorvista.com/content/feed/tvcs/img64.gif"></p>




<p>Imagine that the x-axis represents N, how much input data you have, and the y-axis tells us how many actions or tries it takes the algorithm to finish (worst case scenario, as usual). As N grows larger, the number of tries grows, but slowly.</p>




<p>Let&rsquo;s try calculating a few examples. Keep in mind that when programmers write log N, it refers to <a href="https://stackoverflow.com/questions/1569702/is-big-ologn-log-base-e">log base 2</a>. Also, since the number of actions has to be a whole number, if you get a decimal, the rule of thumb is to round up. So given 10 data, it will take log(10) = 3.32 which rounds up to 4 actions, max. This isn&rsquo;t that much more efficient than O(N), but what if N=1,000,000? It would take your algorithm log(1000000) = 19.93 which rounds up to 20 tries, max. For 1000000 data, that&rsquo;s pretty efficient!</p>




<p>When would we use a logarithmic function to describe the efficiency of an algorithm? One example is the binary search. The binary search algorithm finds a target value within a set of sorted data by repeating the process below until you&rsquo;re left with one value.</p>




<ol>
<li>Find the middle value. If there is more than one, take the higher value.</li>
<li>Compare the target value with the middle value. If it&rsquo;s equal, then we&rsquo;ve found the target. Otherwise, if the target > middle value, then eliminate all values to the left of the middle (lower than the middle); we know the target is in the half with greater values. If the target is &lt;= middle, eliminate the right.</li>
<li>Repeat steps 1 and 2 on the remaining side. Continue until you are left with one value; this is your target.</li>
</ol>




<p>So let&rsquo;s say this is your data, and you&rsquo;re looking for the value, 4.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
</span><span class='line'><span class="n">target</span> <span class="o">=</span> <span class="mi">4</span>
</span></code></pre></td></tr></table></div></figure></p>

<ol>
<li>Find the middle value. There are 10 values, thus two middles. Take the higher: 5.</li>
</ol>


<p><figure class='code'><figcaption><span>first_action</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">middle</span> <span class="o">=</span> <span class="mi">5</span>
</span><span class='line'><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">;</span> <span class="o">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># left side = [0, 1, 2, 3, 4]</span>
</span><span class='line'><span class="c1"># right side = [5, 6, 7, 8, 9]</span>
</span></code></pre></td></tr></table></div></figure></p>

<ol>
<li><p>Compare target with middle. Is it equal to 4? No. Since target &lt;= middle (4 &lt;= 5), eliminate the right side.</p></li>
<li><p>Repeat steps 1 and 2 on the left side. We&rsquo;ll keep doing this until we find the target value, 4.</p></li>
</ol>


<p><figure class='code'><figcaption><span>second_action</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">middle</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># left side = [0, 1]</span>
</span><span class='line'><span class="c1"># right side = [2, 3, 4]</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Check: is target = middle? No. So onto step 2, compare: target > middle (4 > 2). Use the right side.</p>


<p><figure class='code'><figcaption><span>third_action</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">middle</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># left side = [2]</span>
</span><span class='line'><span class="c1"># right side = [3, 4]</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>target = middle? No
So compare again. target > middle (4 > 3). Use the right side.</p>


<p><figure class='code'><figcaption><span>fourth_action</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">middle</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># note, we always take the higher of two as the middle for an even set.</span>
</span><span class='line'><span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># left side = [3]</span>
</span><span class='line'><span class="c1"># right side = [4]</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Target = middle? Yes. We&rsquo;ve found the target and it took 4 tries!</p>




<p>Now let&rsquo;s make sense of this as a logarithmic function: O(log N). We saw above that the calculations work, but why is it log base 2, and why log? If you think of logs as the inverse of exponents, and exponents as repeated multiplication, then logs are repeated division. Where are we dividing in the above procedure? Every step! We&rsquo;re cutting each set in half over and over again until we reach the target, hence repeated division. Why is it log base 2? Log base 2 simply means that we keep dividing by 2, which makes sense because we&rsquo;re cutting the data set in half.</p>




<p>I chose the target number 4 in the binary search method above because it represents the worst case scenario for a set of 10 data. It took 4 tries / actions, and log(10), again with an assumed base 2 since we&rsquo;re in the world of programming, gives us 3.32 which rounds up to 4. Tada!</p>




<p>If you want to see the binary search method or linear methods in action, here&rsquo;s a rather straight-forward <a href="https://www.youtube.com/watch?v=wNVCJj642n4">video</a> demonstrating what I showed above.</p>




<h2>Conclusion and Resources</h2>




<p>I hope that this post helps clarify big O notation for those of you who are brand new to the idea. A few other resources I feel are really well-done: this <a href="http://pointlessprogramming.wordpress.com/2011/02/24/what-in-the-hell-is-big-o/">visual, real-world explanation</a> and this <a href="http://www.daveperrett.com/articles/2010/12/07/comp-sci-101-big-o-notation/">much more technical explanation</a>. I didn&rsquo;t include code in this post because these algorithms are all solved problems already and with some Google sleuthing, you will repos full of them in a multitude of languages. One more resource I like is the <a href="http://bigocheatsheet.com/">big o cheat-sheet</a>.</p>




<p>Happy coding!</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2014-01-05T23:30:00-05:00" pubdate data-updated="true">Jan 5<span>th</span>, 2014</time> in 
    


	<a class='category' href='/blog/categories/big-o/'>big-o</a>, <a class='category' href='/blog/categories/big-o-notation/'>big-o-notation</a>, <a class='category' href='/blog/categories/bigo/'>bigo</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2013/11/06/self-referential-associations/">Self-Referential Associations, AKA Self Joins</a></h2>
  
  <p>
    <p>Week 2 of learning Rails. After 6 weeks at Flatiron, I feel like a beginner again, but not quite like I&rsquo;m stranded on a deserted island &mdash; more like I&rsquo;m Link, and although I wield a wooden sword, new items abound and I&rsquo;m eager to learn how to use them.</p>




<p><img src="http://www.ohmz.net/wp-content/uploads/2011/08/its-dangerous-to-go-alone-take-this.jpg" width="400"></p>




<p>Although the <a href="http://guides.rubyonrails.org/">Rails Guides</a> have been invaluable, trying new constructs myself is how I internalize a concept. This blog post will be about <a href="http://guides.rubyonrails.org/association_basics.html">associations</a>, particularly <a href="http://guides.rubyonrails.org/association_basics.html#self-joins">self joins</a>.</p>




<h2>Mini-Project: Self-Joins</h2>




<p>I created a basic rails app and deployed it on Heroku <a href="https://customer-referrals-testsite.herokuapp.com/">here</a>. Try it out to see how the customer data behaves. Imagine what the schema (or &ldquo;table&rdquo;) might look like and then read on.</p>




<h1>What is a Self Join?</h1>




<p>Below is a self-join. While foreign keys are usually used to link data between two tables, you can use foreign keys to refer to data within the <em>same</em> table to create one that looks something like this:</p>




<p><img src="http://d2o0t5hpnwv4c1.cloudfront.net/538_sql3/ss_5.png" width="600">
<a href="http://net.tutsplus.com/tutorials/databases/sql-for-beginners-part-3-database-relationships/">(source site)</a></p>




<p>I originally tried the following associations below.</p>


<p><figure class='code'><figcaption><span>customer.rb BROKEN VERSION</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Customer</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:referrals</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;Customer&quot;</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">:</span> <span class="s2">&quot;referring_customer_id&quot;</span><span class="p">,</span> <span class="ss">conditions</span><span class="p">:</span> <span class="p">{</span><span class="ss">:referring_customer_id</span> <span class="o">=&gt;</span> <span class="ss">:id</span><span class="p">}</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:referring_customer</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;Customer&quot;</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">:</span> <span class="s2">&quot;referring_customer_id&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This didn&rsquo;t work. After some serious research, stackoverflow, posting my own <a href="http://stackoverflow.com/questions/19803759/how-do-i-create-a-self-referential-association-self-join-in-a-single-class-usi">stackoverflow question</a> (thanks Peter!!!), trial-and-error, and pry sessions, I refactored my code to:</p>


<p><figure class='code'><figcaption><span>customer.rb WORKING VERSION</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Customer</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:referrals</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;Customer&quot;</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">:</span> <span class="s2">&quot;referring_customer_id&quot;</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:referring_customer</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;Customer&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Let&rsquo;s think about this for a second. Why does this work and what does it do? <code>has_many</code> and <code>belongs_to</code> provide <code>Customer</code>s with a set of methods to access their associated data. The options passed often do not change the database since Rails tries to keep logic defined within the application. Why? I&rsquo;m not exactly sure but I suppose this is partially why Rails easily supports a wide range of databases.</p>




<p>Here&rsquo;s what the arguments do:</p>




<ul>
<li><code>class_name: "Customer"</code> tells Rails to look in the <code>Customer</code> class for the association. What do I mean by association? In <code>has_many :referrals</code>, the <code>:referrals</code> is called the assocation. When would I use this? When I need to override the Rails convention for identifying the class in which to find the association.</li>
<li><code>foreign_key: "referring_customer_id"</code> tells Rails where to find the foreign key. When would I use this? When I need to override the Rails convention for identifying the class in which to find the association. Why didn&rsquo;t I use it for <code>belongs_to</code>? It is implicitly defined with that method.</li>
<li><code>conditions: "referring_customer_id = id"</code> actually fires a <code>WHERE</code> SQL statement with the given value. I originally used this thinking it would match referring customers by their id. It turned out to be an extra constraint though &mdash; <code>AND (referring_customer_id = id)</code> &mdash; which filtered for any customer who referred <em>him/herself</em>.</li>
</ul>




<h1>When else can I use self-joins?</h1>




<p>Generally you can use self-joins anytime you need to create a hierarchy-like, &ldquo;nested&rdquo; structure.
<img class="right" src="http://d2o0t5hpnwv4c1.cloudfront.net/538_sql3/graph_5.png" width="400"></p>




<p>Some other applications could be:</p>




<ul>
<li>Creating parent and child directories for Folder objects.</li>
<li>Creating managers and subordinates for Employee objects.</li>
<li>Creating callers and receivers for PhoneTreeMember objects.</li>
<li>Anything else with a parent-child data relationship.</li>
</ul>




<h1>The Master Sword!</h1>




<p>Just when you thought THAT was exciting, there are also plenty of <em>GEMS</em> that allow you to create these nested structures! Two from the Ruby Toolbox are <a href="https://www.ruby-toolbox.com/projects/awesome_nested_set">Awesome Nested Set</a> and <a href="https://www.ruby-toolbox.com/projects/ancestry">Ancestry</a>.</p>




<p><img src="https://lh3.ggpht.com/-XQj1y02FMH4/TcnEMrdHk_I/AAAAAAAAAZE/7ssw-Kwlv7s/s1600/Link_taking_Master_Sword.jpg" width="400"></p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2013-11-06T08:00:00-05:00" pubdate data-updated="true">Nov 6<span>th</span>, 2013</time> in 
    


	<a class='category' href='/blog/categories/activerecord/'>activerecord</a>, <a class='category' href='/blog/categories/associations/'>associations</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby-on-rails/'>ruby-on-rails</a>, <a class='category' href='/blog/categories/self-joins/'>self-joins</a>, <a class='category' href='/blog/categories/self-referential/'>self-referential</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2013/10/23/throw-raise/">Ruby &#8216;Exceptional&#8217; Knowledge</a></h2>
  
  <p>
    <h2>Foreward</h2>




<p>Most of us have encountered the methods <code>raise</code>, <code>rescue</code>, <code>catch</code>, <code>throw</code>, and <code>break</code> in Ruby. We can generally understand what&rsquo;s going on when we read code that uses it, but what exactly is the difference between them all? Here&rsquo;s a quick guide plus some fun and useful facts.</p>




<h1>If you remember just one thing&hellip;</h1>




<ul>
<li><code>raise</code> and <code>rescue</code> are used for handling errors <em>only</em></li>
<li><code>throw</code> and <code>catch</code> are used in order to terminate execution early when no other work is needed. <a href="http://rubylearning.com/blog/2011/07/12/throw-catch-raise-rescue-im-so-confused/">source</a></li>
</ul>




<h1>Raise and Rescue</h1>




<p><code>raise</code> and <code>rescue</code> are used exclusively for handling errors. By default, raising an error will exit the program.</p>


<p><figure class='code'><figcaption><span>exception.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_rescue</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;This is before raise&quot;</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s2">&quot;Raised an error&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;This is after raise. It won&#39;t ever run.&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">test_rescue</span>
</span><span class='line'><span class="c1"># =&gt; This is before raise</span>
</span><span class='line'><span class="c1"># =&gt; test.rb:3:in <code>test_rescue&amp;#39;: Raised an error (RuntimeError)&lt;/span&gt;
&lt;/span&gt;&lt;span class='line'&gt;  &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rb&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="ss"&gt;:in&lt;/span&gt; &lt;span class="sb"&gt;</code>&lt;main&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This happens unless there is a <code>rescue</code> statement which will run in case of an exception.</p>


<p><figure class='code'><figcaption><span>exception.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_rescue</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;This is before raise&quot;</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s2">&quot;Raised an error&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;This is after raise. It won&#39;t ever run.&quot;</span>
</span><span class='line'>  <span class="k">rescue</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;I&#39;m rescued!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">test_rescue</span>
</span><span class='line'><span class="c1"># =&gt; This is before raise</span>
</span><span class='line'><span class="c1"># =&gt; I&#39;m rescued!</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The above Ruby code can be rewritten like so:</p>


<p><figure class='code'><figcaption><span>exception.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">test_rescue</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;This is before raise&quot;</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s2">&quot;Raised an error&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;This is after raise. It won&#39;t ever run.&quot;</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">e</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">test_rescue</span>
</span><span class='line'><span class="c1"># =&gt; This is before raise</span>
</span><span class='line'><span class="c1"># =&gt; Raised an error</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Ruby has many different types of exceptions (see <a href="http://ruby-doc.org/core-2.0.0/Exception.html">documentation</a>).
Raise takes up to three parameters:
 * the exception type
 * an error message
 * an array of callback information.</p>




<p>All three are optional and Ruby knows that if you only pass in a string that it&rsquo;s the message. Usually you don&rsquo;t set the last parameter since <code>Kernel#caller</code> automatically creates that array.</p>




<p>Here are a couple of valid <code>raise</code> statements.</p>


<p><figure class='code'><figcaption><span>Message parameter given</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">raise</span> <span class="s2">&quot;This is an error&quot;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>Error and Message parameters</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">raise</span> <span class="no">StandardError</span> <span class="s2">&quot;Most error subclasses extend StandardError&quot;</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3>Exceptional Ruby</h3>




<p>Exception is the root of Ruby&rsquo;s exception hierarchy. It&rsquo;s the class from which all Exceptions descend. It is king. This has a very interesting consequence.</p>




<p><code>rescue Exception</code> rescues from EVERYTHING, including syntax errors, load errors, and any of the following listed below.</p>




<ul>
<li><p>Rescuing <code>Interrupt</code> prevents you from being able to CTRL+C out of the program.</p></li>
<li><p>Rescuing <code>SignalException</code> prevents the program from responding correctly to signals. It will be unkillable, except with kill -9. <a href="http://stackoverflow.com/questions/10048173/why-is-it-bad-style-to-rescue-exception-e-in-ruby">source</a></p></li>
</ul>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">loop</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">begin</span>
</span><span class='line'>    <span class="nb">eval</span> <span class="n">dinosaurs</span> <span class="n">ru1ez</span> <span class="n">the</span> <span class="n">pl</span><span class="vi">@netz</span><span class="o">!!!</span> <span class="no">ROArR</span><span class="p">{</span><span class="n">bark</span><span class="p">}</span><span class="o">[</span><span class="ss">:ARF</span><span class="o">].</span><span class="n">ENV</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="no">Exception</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;What meteor?&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<h1>Break, Catch, and Throw</h1>




<p><code>break</code>, <code>catch</code> and <code>throw</code> are used in order to terminate execution early when no other work is needed. <code>break</code> leaves the <em>current</em> loop while the <code>catch</code> and <code>throw</code> combination can be used to break out of <em>any number</em> of loops at one time.</p>


<p><figure class='code'><figcaption><span>break example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">array</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;brainfuck&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span> <span class="s2">&quot;befunge&quot;</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="s2">&quot;perl&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">language</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;My favorite computer langauge is </span><span class="si">#{</span><span class="n">language</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">break</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#  =&gt; &quot;My favorite computer langauge is brainfuck&quot;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>hypothetical throw and catch example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># =&gt; recipe_hash = {&hellip;}</span>
</span><span class='line'><span class="k">def</span> <span class="nf">show_recipe_for</span><span class="p">(</span><span class="n">recipe_name</span><span class="p">)</span>
</span><span class='line'>  <span class="n">recipe</span> <span class="o">=</span> <span class="kp">catch</span><span class="p">(</span><span class="ss">:recipe</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">recipe_hash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">meal_type</span><span class="p">,</span> <span class="n">dish_hash</span><span class="o">|</span>
</span><span class='line'>      <span class="n">dish_hash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dish</span><span class="p">,</span> <span class="n">dish_recipe</span><span class="o">|</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">recipe_name</span> <span class="o">==</span> <span class="n">dish_recipe</span>
</span><span class='line'>          <span class="kp">throw</span> <span class="ss">:recipe</span><span class="p">,</span> <span class="n">dish_recipe</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Notice that the two loops are enclosed in the <code>catch</code> block. This means that once the <code>throw</code> statement is executed, it will store the value of its second argument into <code>:recipe</code> and send it back to the catch statement. By doing so, it exits all the loops after finding the first recipe match. From there, the method finishes executing as normal.</p>




<p>Because my example is a bit contrived, I will post a real-life example from another <a href="http://rubylearning.com/blog/2011/07/12/throw-catch-raise-rescue-im-so-confused/">blog</a> by rubyist Avdi Grimm.</p>


<p><figure class='code'><figcaption><span>google search scraping example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">show_rank_for</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span class='line'>  <span class="n">rank</span> <span class="o">=</span> <span class="kp">catch</span><span class="p">(</span><span class="ss">:rank</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">each_google_result_page</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">page</span><span class="p">,</span> <span class="n">page_index</span><span class="o">|</span>
</span><span class='line'>      <span class="n">each_google_result</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="p">,</span> <span class="n">result_index</span><span class="o">|</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span class='line'>          <span class="kp">throw</span> <span class="ss">:rank</span><span class="p">,</span> <span class="p">(</span><span class="n">page_index</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">result_index</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="s2">&quot;&lt;not found&gt;&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">target</span><span class="si">}</span><span class="s2"> is ranked </span><span class="si">#{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> for search &#39;</span><span class="si">#{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Since loading pages over and over again can be an expensive process, the coder above uses a <code>throw</code>&ndash;<code>catch</code> to exit the loop when the first matching result is found.</p>




<h2>Throw, Catch and Sinatra</h2>




<p>An even more mind-blowing example from the <a href="http://rubylearning.com/blog/2011/07/12/throw-catch-raise-rescue-im-so-confused/">same blog post</a> reveals that Sinatra has a built-in catch for the <code>#last-modified</code> method. You might use this method to check a user&rsquo;s <em>cache</em> for what version of a certain page the user has on his/her machine. Why would you do this? Simple! In order to cut out any expensive and unnecessary processing. If the page in the cache is old, then you&rsquo;d update the page. Otherwise, just load from cache.</p>




<p>For your convenience, here&rsquo;s the simplified code Grimm posted to demonstrate.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">last_modified</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
</span><span class='line'>  <span class="n">response</span><span class="o">[</span><span class="s1">&#39;Last-Modified&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">time</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">env</span><span class="o">[</span><span class="s1">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">time</span>
</span><span class='line'>    <span class="kp">throw</span> <span class="ss">:halt</span><span class="p">,</span> <span class="n">response</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>When Ruby encounters the <code>throw</code>, it zips back up the call stack looking for a matching symbol, <code>:halt</code>. Where&rsquo;s the <code>catch</code> block though? It&rsquo;s clearly not in the same method as the <code>throw</code>. This means that it must be further up the stack. In other words, <code>#last_modified</code> was called within a <code>catch</code> block.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">catch</span> <span class="p">(</span><span class="ss">:halt</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># code</span>
</span><span class='line'>  <span class="n">last_modified</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="c1"># =&gt; the throw in this method sends :halt up to the encapsulating catch</span>
</span><span class='line'>  <span class="c1"># code</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

  </p>
  <span class="meta">
    written 








  


<time datetime="2013-10-23T08:00:00-04:00" pubdate data-updated="true">Oct 23<span>rd</span>, 2013</time> in 
    


	<a class='category' href='/blog/categories/break/'>break</a>, <a class='category' href='/blog/categories/catch/'>catch</a>, <a class='category' href='/blog/categories/exceptions/'>exceptions</a>, <a class='category' href='/blog/categories/raise/'>raise</a>, <a class='category' href='/blog/categories/rescue/'>rescue</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/throw/'>throw</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2013/10/08/rails-presentation-post/">ActiveRecord</a></h2>
  
  <p>
    <p>I took a bit of a dive today and looked a Ruby on Rails <a href="http://www.slideshare.net/aizatto/ruby-on-rails-48391">presentation</a>. Here&rsquo;s what I gleaned from looking through all the slides.</p>




<ul>
<li><p>Rails is a web application framework that allows your Ruby to interact with the web seamlessly. By &ldquo;interact with the web&rdquo;, I assume the presentation means &ldquo;interact with databases.&rdquo;</p></li>
<li><p>Rails implements a principle called &ldquo;MVC&rdquo; &mdash; Model View Controller. Rails seems to handle each task separately. I&rsquo;m going to focus on the Model, which uses ActiveRecord.</p></li>
<li><p>ActiveRecord is a Module that Rails uses to model and interact with databases. It makes database queries both simple and intuitive.</p></li>
</ul>




<p>Here are some concrete query comparisons between using SQLite3 versus Rails&#8217; ActiveRecord.</p>




<p>Assume we have a table called &ldquo;dogs,&rdquo; each with a name, age, weight, and type. Each attribute would be a column, and each row would represent a different dog.</p>


<p><figure class='code'><figcaption><span>Table using SQLite3</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dogs</span> <span class="p">(</span>
</span><span class='line'>  <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTOINCREMENT</span><span class="p">,</span>
</span><span class='line'>  <span class="n">name</span> <span class="nb">TEXT</span><span class="p">;</span>
</span><span class='line'>  <span class="n">age</span> <span class="nb">INTEGER</span><span class="p">;</span>
</span><span class='line'>  <span class="n">weight</span> <span class="nb">INTEGER</span><span class="p">;</span>
</span><span class='line'>  <span class="k">type</span> <span class="nb">TEXT</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>We can also imagine this as a class of Dog objects in Ruby. Here&rsquo;s how one might create the barebones structure in Ruby.</p>


<p><figure class='code'><figcaption><span>Dogs as objects of class Dog in Ruby</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Dog</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:weight</span><span class="p">,</span> <span class="ss">:type</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>Table initialized using Rails&#8217; ActiveRecord</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Dog</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>See how simple that was? Now we can make queries on the table.</p>


<p><figure class='code'><figcaption><span>SQLite3 query for first dog in table</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dogs</span> <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>Rails query for first dog in table</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Dog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That&rsquo;s just the beginning! Check this out.</p>


<p><figure class='code'><figcaption><span>SQLite3 query appending conditions</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dogs</span> <span class="k">WHERE</span> <span class="n">age</span><span class="o">=</span><span class="mi">8</span> <span class="k">AND</span> <span class="k">type</span><span class="o">=</span><span class="ss">&quot;corgi&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>Rails query appending same conditions</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Dog</span><span class="o">.</span><span class="n">find_by_age_and_type</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;corgi&quot;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>It seems like ActiveRecord must use certain keywords like &lsquo;by&rsquo; and &lsquo;and&rsquo; in order to dynamically use the attribute names that the user inputs.</p>




<p>What is really beautiful though is the idea of &ldquo;configuration of convention&rdquo; that Rails implements in order to shorten the amount of code you need to write. Slides 42-44 of the <a href="http://www.slideshare.net/aizatto/ruby-on-rails-48391">presentation</a>  gave a particularly good example of the idea. No wonder people love Rails!</p>




<p>The slides continue talking about the MVC</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2013-10-08T07:00:00-04:00" pubdate data-updated="true">Oct 8<span>th</span>, 2013</time> in 
    


	<a class='category' href='/blog/categories/activerecord/'>activerecord</a>, <a class='category' href='/blog/categories/mvc/'>mvc</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2013/10/07/flatten-arrays/">Recursive Arrays</a></h2>
  
  <p>
    <h2>Foreword</h2>




<p>I feel a certain level of confidence declaring that every programmer has been in the situation where he/she has 10+ tabs open trying troubleshooting a problem and finally concludes, &ldquo;There must be an easier way.&rdquo; Or, if you&rsquo;ve been &lsquo;in the zone&rsquo; for long enough, you might start wondering what exactly got you in this troubleshooting hell to begin with.</p>




<p>In this post, I will share what I learned from one such experience.</p>




<h3>Context and Problem</h3>




<p>I was writing an automatic schedule-maker in Ruby. create_groups is a method that, takes an array of student names and returns an array of the students in a specified group sizes. The create_groups method also takes a parameter that allows you to specify a number of groups. The student groups should be randomized.</p>




<p>First, I defined the method create_groups, set up an array of grouped students that I can push groups into, and returned the value.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class='line'>  <span class="n">groups</span> <span class="o">=</span> <span class="o">[]</span>  <span class="c1">#=&gt; store the groups of students in this array</span>
</span><span class='line'>  <span class="c1"># Implement magic.</span>
</span><span class='line'>  <span class="n">groups</span>  <span class="c1">#=&gt; Return groups</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span><span class='line'><span class="n">students</span> <span class="o">=</span> <span class="o">[.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.]</span> <span class="c1">#=&gt; This array contains 41 student names. Check my Github Gist linked below for the array I used in the completed program.</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After considering several strategies, I decided that it would make the most sense sort the 40 students using what I dubbed the &ldquo;card dealing method&rdquo; &mdash; The first student goes to group 1, the second to group 2, the third to group 3, and so forth.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class='line'>  <span class="n">groups</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">normalized_list</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class='line'>  <span class="n">normalized_list</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="c1"># This part will sort students using the &quot;card-dealing method&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">groups</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Since there are 20 groups of 4, I needed 80 students. On an abstract level, the number of students I need in order to sort (the &ldquo;desired length&rdquo;) is &ldquo;# of groups&rdquo; x &ldquo;# of students per group&rdquo;.</p>




<p>I decided to create another method which would normalize my list to this set amount.</p>




<p>The #normalize method will return an array of desired length by <em>replicating the students a number of times, and then slicing out the desired number of students from the replicated array.</em></p>




<p>Here&rsquo;s what I came up with at first:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create_groups</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">#&hellip;folded this code for now&hellip;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">list_to_norm</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class='line'>  <span class="n">desired_length</span> <span class="o">=</span> <span class="n">group_size</span><span class="o">*</span><span class="n">number_of_groups</span>
</span><span class='line'>  <span class="n">new_list</span> <span class="o">=</span> <span class="n">list_to_norm</span>
</span><span class='line'>  <span class="k">while</span> <span class="n">new_list</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">desired_length</span>
</span><span class='line'>    <span class="n">new_list</span> <span class="o">&lt;&lt;</span> <span class="n">list_to_norm</span>
</span><span class='line'>    <span class="n">new_list</span> <span class="o">=</span> <span class="n">new_list</span><span class="o">.</span><span class="n">flatten</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>When I ran this given a student array though, I received the following error:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>rb24:<span class="sb">`</span>flatten<span class="err">&#39;</span>: tried to flatten recursive array <span class="o">(</span>ArgumentError<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>WAT? After many attempts at troubleshooting and searching the web for an answer, I decided to inspect what exactly I was trying to flatten.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">list_to_norm</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">number_of_groups</span><span class="p">)</span>
</span><span class='line'>  <span class="n">desired_length</span> <span class="o">=</span> <span class="n">group_size</span><span class="o">*</span><span class="n">number_of_groups</span>
</span><span class='line'>  <span class="n">new_list</span> <span class="o">=</span> <span class="n">list_to_norm</span>
</span><span class='line'>  <span class="n">new_list</span> <span class="o">&lt;&lt;</span> <span class="n">list_to_norm</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">new_list</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The output was VERY telling. The <code>...</code> line below is just a placeholder for names 4 through 40.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Name1
</span><span class='line'>Name2
</span><span class='line'>Name3
</span><span class='line'>&hellip;
</span><span class='line'>Name41
</span><span class='line'><span class="o">[</span>&hellip;<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The clue was in the <code>[...]</code>.</p>




<p>I then tried running <code>new_list.object_id</code> and <code>list_to_norm.object_id</code> and they turned out to be the same.</p>




<h3>A-ha!</h3>




<p>The <code>[...]</code> indicated that new_list is now a <em>recursive array</em>. More on recurive arrays <a href="http://stackoverflow.com/questions/10606734/what-are-recursive-arrays-good-for">here</a>.</p>




<p>As it turns out, my problem was in the 2nd line of my normalize method.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">new_list</span> <span class="o">=</span> <span class="n">list_to_norm</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This line of code sets the <code>new_list</code> variable to point at the exact same object as the <code>list_to_norm</code> method. So later, when I called <code>new_list &lt;&lt; list_to_norm</code>, I ended up pushing an Array object into itself. The image below</p>




<p>However, Ruby clearly didn&rsquo;t like this, and I suspect that it has to do with the way <code>Array.flatten</code> works. At the very least, we can conclude that <code>.flatten</code> can only flatten two different Array objects.</p>




<p>So that&rsquo;s what I learned in 40 minutes of head-banging against a figurative brick wall. I hope you learned something as well from this post!</p>




<p>Also, as promised, here is a link to <a href="https://gist.github.com/danielchangNYC/6787872">my full gist</a>.</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2013-10-07T13:00:00-04:00" pubdate data-updated="true">Oct 7<span>th</span>, 2013</time> in 
    


	<a class='category' href='/blog/categories/aha/'>aha</a>, <a class='category' href='/blog/categories/arrays/'>arrays</a>, <a class='category' href='/blog/categories/object-oriented-programming/'>object_oriented_programming</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>



  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2013/10/04/week-2/">(Not the) First Post</a></h2>
  
  <p>
    <h1>Level up!</h1>




<p>This is my post using the Octopress framework. I&rsquo;m excited to be able to start posting code without taking screen shots of my Sublime Text.</p>




<p>My original code blog on <a href="http://c0depanda.wordpress.com/">Wordpress</a>.</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2013-10-04T10:59:00-04:00" pubdate data-updated="true">Oct 4<span>th</span>, 2013</time> in 
    


  </span>

  
</article>

        </div>
      </div>
      
    </div>
  </div>
</div>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Daniel Chang

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'danielchangnyc';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>